{% extends 'base.html' %}

{% block title %}Inspection List{% endblock %}

{% block heading_h1 %}Daily Inspections{% endblock %}
{% block heading_h2 %}View all inspection records{% endblock %}

{% block extra_css %}
<style>
    .table tbody tr {
        transition: all 0.2s ease-in-out;
    }

    .table tbody tr:hover {
        background-color: #f0f0f0 !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .progress {
        height: 10px;
        width: 150px;
        margin-top: 5px;
        background-color: #e9ecef;
        border-radius: 5px;
    }

    .progress-stats {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .inspection-progress {
        min-width: 200px;
    }

     .status-badge {
          display: inline-flex;
          align-items: center;
          padding: 0.25rem 0.5rem;
          font-size: 0.9rem;
          font-weight: 500;
          border-radius: 0.25rem;
          margin-right: 5px;
          margin-bottom: 5px;
      }

      .status-badge i {
          margin-right: 0.3rem;
      }
      .status-modal-content{
          text-align: left;
      }
      .status-modal-content i {
          margin-right: 5px;
          font-size: 1.2rem;
          width: 25px;
          display: inline-block;
      }
      .view-inspection-btn {
        border: none;
        background: none;
        cursor: pointer;
        color: #68B2E3; /* Bootstrap's primary color, you can change as needed */
        transition: color 0.3s ease;
      }
      .view-inspection-btn:hover {
          color: #4a9ed8; /* A slightly darker shade of the primary color, on hover */
          text-decoration: none;
      }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead class="table-light">
                            <tr>
                                <th><i class="bi bi-calendar-date"></i> Date</th>
                                <th><i class="bi bi-person-workspace"></i> Shift</th>
                                <th><i class="bi bi-bar-chart-line"></i> Quick Stats</th>
                               <th><i class="bi bi-eye-fill"></i> View</th>
                                <th><i class="bi bi-graph-up"></i> Progress</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for inspection in inspections %}
                            <tr>
                                <td>{{ inspection.initiated_at|date:"d M Y" }}</td>
                                <td>
                                    {% if inspection.shift == 'DAY' %}
                                        <span class="badge bg-warning text-dark">
                                            <i class="bi bi-sun-fill"></i> Day
                                        </span>
                                    {% else %}
                                        <span class="badge bg-dark">
                                            <i class="bi bi-moon-fill"></i> Night
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                     <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#statusModal{{ forloop.counter }}">
                                         Stats
                                     </button>
                                     <!-- Modal -->
                                     <div class="modal fade" id="statusModal{{ forloop.counter }}" tabindex="-1" aria-labelledby="statusModalLabel{{ forloop.counter }}" aria-hidden="true">
                                         <div class="modal-dialog modal-dialog-centered">
                                             <div class="modal-content status-modal-content">
                                                 <div class="modal-header">
                                                     <h5 class="modal-title" id="statusModalLabel{{ forloop.counter }}">Status Summary</h5>
                                                     <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                 </div>
                                                 <div class="modal-body">
                                                     {% if inspection.status_counts %}
                                                         <p><i class="bi bi-check-circle text-success"></i>OK: {{ inspection.status_counts.OK|default:0 }}</p>
                                                         <p><i class="bi bi-exclamation-triangle text-warning"></i>WARNING: {{ inspection.status_counts.WARNING|default:0 }}</p>
                                                         <p><i class="bi bi-exclamation-octagon text-danger"></i>ALARM: {{ inspection.status_counts.ALARM|default:0 }}</p>
                                                         <p><i class="bi bi-check-square text-primary"></i>DONE: {{ inspection.status_counts.DONE|default:0 }}</p>
                                                         <p><i class="bi bi-power text-secondary"></i>OFF: {{ inspection.status_counts.OFF|default:0 }}</p>
                                                         <p><i class="bi bi-slash-circle text-muted"></i>UNSERVICEABLE: {{ inspection.status_counts.UNSERVICEABLE|default:0 }}</p>
                                                     {% endif %}
                                                     <p><i class="bi bi-hourglass-split text-info"></i>Pending: {{ inspection.pending_count|default:0 }}</p>
                                                 </div>
                                                 <div class="modal-footer">
                                                     <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                </td>
                                <td>
                                     <a href="{% url 'inspection_detail' inspection.inspection_ident %}" class="view-inspection-btn" title="View Inspection">
                                        <i class="bi bi-box-arrow-up-right"></i> Open Inspection
                                     </a>
                                </td>
                                <td class="inspection-progress">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-grow-1">
                                            <div class="progress-stats mb-1">
                                                {{ inspection.inspected_count }} / {{ inspection.total_count }} Assets
                                                <span class="float-end">{{ inspection.progress_percentage|floatformat:1 }}%</span>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar {% if inspection.progress_percentage == 100 %}bg-success{% elif inspection.progress_percentage > 50 %}bg-info{% else %}bg-warning{% endif %}"
                                                     role="progressbar"
                                                     style="width: {{ inspection.progress_percentage }}%"
                                                     aria-valuenow="{{ inspection.progress_percentage }}"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-4">
                                    <i class="bi bi-inbox text-muted" style="font-size: 2rem;"></i>
                                    <p class="text-muted mt-2">No inspections found</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}